<script type="text/babel">
    // Subscription Management Modal
    const SubscriptionManagementModal = ({ onClose, loggedInUser, onSubscriptionUpdated }) => {
        const { useState, useEffect } = React;
        const [isLoading, setIsLoading] = useState(false);
        const [error, setError] = useState('');
        const [activeTab, setActiveTab] = useState('overview');
        const [subscription, setSubscription] = useState(null);
        const [billingHistory, setBillingHistory] = useState([]);
        const [pagination, setPagination] = useState({ page: 1, limit: 10, total_pages: 1, total_count: 0 });
        // Upgrade tab state - must be at top level to follow Rules of Hooks
        const [selPlan, setSelPlan] = useState('si_plus');
        const [selUsers, setSelUsers] = useState(1);
        const [selCycle, setSelCycle] = useState('monthly');
        const [isUpgrading, setIsUpgrading] = useState(false);
        const [lastRequestId, setLastRequestId] = useState(null);
        const [lastRequestParams, setLastRequestParams] = useState(null);

        useEffect(() => { fetchSubscription(); }, []);
        useEffect(() => { window.refreshSubscriptionData = fetchSubscription; return () => { try { delete window.refreshSubscriptionData; } catch (e) { } } }, []);

        // Update upgrade tab state when subscription data is loaded
        useEffect(() => {
            if (subscription) {
                setSelUsers(subscription.user_count || 1);
                setSelCycle(subscription.billing_cycle || 'monthly');
            }
        }, [subscription]);

        const fetchSubscription = async () => {
            setIsLoading(true);
            setError('');
            try {
                const res = await makeAuthenticatedRequest('/api/org/subscription', { method: 'GET', headers: { 'Content-Type': 'application/json' } });
                const data = await res.json();
                if (data.status === 'success') {
                    setSubscription(data.subscription);
                    fetchBillingHistory(1, {});
                } else {
                    setError(data.message || 'Failed to fetch subscription');
                }
            } catch (e) {
                setError('Failed to fetch subscription');
            } finally {
                setIsLoading(false);
            }
        };

        const fetchBillingHistory = async (page = 1, filters = {}) => {
            try {
                const qp = new URLSearchParams({ page, limit: 10, ...filters });
                const res = await makeAuthenticatedRequest(`/api/org/billing/history?${qp.toString()}`, { method: 'GET', headers: { 'Content-Type': 'application/json' } });
                const data = await res.json();
                if (data.status === 'success') {
                    setBillingHistory(data.transactions || []);
                    setPagination(data.pagination || { page, limit: 10, total_pages: 1, total_count: 0 });
                }
            } catch (e) { /* no-op */ }
        };

        const handleUpgrade = async (newPlanType, userCount, billingCycle) => {
            if (isUpgrading) return;
            setError('');
            setIsUpgrading(true);
            const generateFallbackUUID = () => 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
                const r = Math.random() * 16 | 0;
                const v = c === 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });
            const shouldReuseKey = lastRequestId
                && lastRequestParams
                && lastRequestParams.plan === newPlanType
                && lastRequestParams.users === userCount
                && lastRequestParams.cycle === billingCycle;
            const idempotencyKey = shouldReuseKey
                ? lastRequestId
                : ((window.crypto && window.crypto.randomUUID)
                    ? window.crypto.randomUUID()
                    : generateFallbackUUID());
            if (!shouldReuseKey) {
                setLastRequestId(idempotencyKey);
                setLastRequestParams({ plan: newPlanType, users: userCount, cycle: billingCycle });
            }
            try {
                const res = await makeAuthenticatedRequest('/api/org/subscription/upgrade', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        new_plan_type: newPlanType,
                        user_count: userCount,
                        billing_cycle: billingCycle,
                        idempotency_key: idempotencyKey
                    })
                });
                const data = await res.json();
                const resolvedRequestId = data.request_id || idempotencyKey;
                setLastRequestId(resolvedRequestId);
                setLastRequestParams({ plan: newPlanType, users: userCount, cycle: billingCycle });
                if (data.status === 'success') {
                    if (data.requires_payment) {
                        if (window.openRazorpayCheckout) {
                            window.openRazorpayCheckout(data);
                        }
                    } else {
                        alert('Subscription upgrade already processed. No additional payment is required.');
                        setLastRequestId(null);
                        setLastRequestParams(null);
                        fetchSubscription();
                        if (onSubscriptionUpdated) onSubscriptionUpdated();
                    }
                } else {
                    const message = data.message || (res.status === 409 ? 'Payment already in progress. Please wait.' : 'Failed to upgrade subscription');
                    setError(message);
                    setTimeout(() => setError(''), 5000);
                    if (data.request_id) {
                        setLastRequestId(data.request_id);
                        setLastRequestParams({ plan: newPlanType, users: userCount, cycle: billingCycle });
                    }
                }
            } catch (e) {
                setError('Failed to upgrade subscription');
                setTimeout(() => setError(''), 5000);
            } finally {
                setIsUpgrading(false);
            }
        };

        const handleCancel = async (cancelAtCycleEnd = true, reason = '') => {
            try {
                const res = await makeAuthenticatedRequest('/api/org/subscription/cancel', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ cancel_at_cycle_end: cancelAtCycleEnd, reason }) });
                const data = await res.json();
                if (data.status === 'success') {
                    alert(data.message);
                    fetchSubscription();
                    if (onSubscriptionUpdated) onSubscriptionUpdated();
                } else {
                    setError(data.message || 'Failed to cancel subscription');
                }
            } catch (e) { setError('Failed to cancel subscription'); }
        };

        const handlePause = async (pauseDuration = 1, reason = '') => {
            try {
                const res = await makeAuthenticatedRequest('/api/org/subscription/pause', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ pause_duration: pauseDuration, reason }) });
                const data = await res.json();
                if (data.status === 'success') {
                    alert(data.message);
                    fetchSubscription();
                    if (onSubscriptionUpdated) onSubscriptionUpdated();
                } else {
                    setError(data.message || 'Failed to pause subscription');
                }
            } catch (e) { setError('Failed to pause subscription'); }
        };

        const downloadInvoice = async (transactionId) => {
            try {
                const response = await makeAuthenticatedRequest(`/api/org/billing/invoice/${transactionId}`, { method: 'GET' });
                if (response.ok) {
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url; a.download = `invoice_${transactionId}.pdf`; document.body.appendChild(a); a.click(); document.body.removeChild(a); window.URL.revokeObjectURL(url);
                } else {
                    const data = await response.json();
                    alert(data.message || 'Failed to download invoice');
                }
            } catch (e) { alert('Failed to download invoice'); }
        };

        if (isLoading) {
            return React.createElement('div', { className: 'fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50' },
                React.createElement('div', { className: 'bg-white rounded-lg p-8 max-w-md' },
                    React.createElement('div', { className: 'animate-pulse' },
                        React.createElement('div', { className: 'h-8 bg-slate-200 rounded w-3/4 mb-4' }),
                        React.createElement('div', { className: 'h-4 bg-slate-200 rounded w-full mb-2' }),
                        React.createElement('div', { className: 'h-4 bg-slate-200 rounded w-5/6 mb-2' }),
                        React.createElement('div', { className: 'h-4 bg-slate-200 rounded w-4/6' })
                    )
                )
            );
        }

        if (error) {
            return React.createElement('div', { className: 'fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50' },
                React.createElement('div', { className: 'bg-white rounded-lg p-8 max-w-md' },
                    React.createElement('div', { className: 'text-red-600 text-center' },
                        React.createElement('p', { className: 'font-medium mb-2' }, 'Failed to load subscription'),
                        React.createElement('p', { className: 'text-sm text-slate-600 mb-4' }, error),
                        React.createElement('button', { onClick: () => { setError(''); fetchSubscription(); }, className: 'px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700' }, 'Retry')
                    )
                )
            );
        }

        const closeArea = React.createElement('div', { className: 'fixed inset-0 bg-black/60 backdrop-blur-sm z-50', onClick: onClose });
        const content = React.createElement('div', { className: 'fixed inset-0 z-50 flex items-center justify-center p-4' },
            React.createElement('div', { className: 'bg-white rounded-xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-auto' },
                React.createElement('div', { className: 'flex items-center justify-between p-4 border-b' },
                    React.createElement('h2', { className: 'text-xl font-bold text-slate-800' }, 'Manage Subscription'),
                    React.createElement('button', { onClick: onClose, className: 'p-2 rounded hover:bg-slate-100' }, 'âœ•')
                ),
                React.createElement('div', { className: 'px-4 pt-2' },
                    React.createElement('div', { className: 'flex gap-2 mb-4' },
                        ['overview', 'billing', 'upgrade'].map(tab => (
                            React.createElement('button', { key: tab, onClick: () => setActiveTab(tab), className: `px-4 py-2 rounded-lg text-sm ${activeTab === tab ? 'bg-slate-900 text-white' : 'bg-slate-100 text-slate-700 hover:bg-slate-200'}` }, tab.charAt(0).toUpperCase() + tab.slice(1))
                        ))
                    ),
                    activeTab === 'overview' && subscription && React.createElement('div', { className: 'space-y-4 mb-6' },
                        React.createElement('div', { className: 'p-4 bg-slate-50 rounded-lg border' },
                            React.createElement('div', { className: 'flex flex-wrap gap-4 items-center justify-between' },
                                React.createElement('div', null,
                                    React.createElement('div', { className: 'text-sm text-slate-500' }, 'Current Plan'),
                                    React.createElement('div', { className: 'text-lg font-semibold' }, subscription.plan_display_name || subscription.plan_type)
                                ),
                                React.createElement('div', null,
                                    React.createElement('div', { className: 'text-sm text-slate-500' }, 'Status'),
                                    React.createElement('div', { className: 'text-sm font-medium' }, subscription.status)
                                ),
                                React.createElement('div', null,
                                    React.createElement('div', { className: 'text-sm text-slate-500' }, 'Next Billing'),
                                    React.createElement('div', { className: 'text-sm font-medium' }, subscription.next_billing_date || 'â€”')
                                )
                            )
                        ),
                        React.createElement('div', { className: 'flex gap-2' },
                            subscription.can_upgrade && React.createElement('button', { onClick: () => setActiveTab('upgrade'), className: 'px-4 py-2 bg-gradient-to-r from-indigo-500 to-purple-600 text-white rounded-lg' }, 'Upgrade Plan'),
                            subscription.can_pause && React.createElement('button', { onClick: () => handlePause(1, ''), className: 'px-4 py-2 bg-yellow-500 text-white rounded-lg' }, 'Pause'),
                            subscription.can_cancel && React.createElement('button', { onClick: () => handleCancel(true, ''), className: 'px-4 py-2 bg-red-600 text-white rounded-lg' }, 'Cancel')
                        )
                    ),
                    activeTab === 'billing' && React.createElement('div', null,
                        // Summary cards
                        subscription && React.createElement('div', { className: 'grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 mb-4' },
                            React.createElement('div', { className: 'p-3 bg-slate-50 rounded border' }, React.createElement('div', { className: 'text-xs text-slate-500' }, 'Total Paid'), React.createElement('div', { className: 'text-lg font-semibold', id: 'bh-total-paid' })),
                            React.createElement('div', { className: 'p-3 bg-slate-50 rounded border' }, React.createElement('div', { className: 'text-xs text-slate-500' }, 'Total Transactions'), React.createElement('div', { className: 'text-lg font-semibold' }, pagination.total_count || 0)),
                            React.createElement('div', { className: 'p-3 bg-slate-50 rounded border' }, React.createElement('div', { className: 'text-xs text-slate-500' }, 'Last Payment'), React.createElement('div', { className: 'text-lg font-semibold', id: 'bh-last-payment' })),
                            React.createElement('div', { className: 'p-3 bg-slate-50 rounded border' }, React.createElement('div', { className: 'text-xs text-slate-500' }, 'Failed Payments'), React.createElement('div', { className: 'text-lg font-semibold', id: 'bh-failed' }))
                        ),
                        // Filters
                        React.createElement('div', { className: 'flex flex-wrap gap-2 mb-3' },
                            React.createElement('select', { id: 'bh-status', className: 'p-2 bg-white border rounded' }, ['all', 'success', 'failed', 'pending'].map(s => React.createElement('option', { key: s, value: s === 'all' ? '' : s }, s.charAt(0).toUpperCase() + s.slice(1)))),
                            React.createElement('input', { id: 'bh-start', type: 'date', className: 'p-2 bg-white border rounded' }),
                            React.createElement('input', { id: 'bh-end', type: 'date', className: 'p-2 bg-white border rounded' }),
                            React.createElement('button', {
                                onClick: () => {
                                    const status = document.getElementById('bh-status').value;
                                    const start = document.getElementById('bh-start').value;
                                    const end = document.getElementById('bh-end').value;
                                    const filters = {};
                                    if (status) filters.status = status;
                                    if (start) filters.start_date = start;
                                    if (end) filters.end_date = end;
                                    fetchBillingHistory(1, filters);
                                }, className: 'px-3 py-2 bg-slate-900 text-white rounded'
                            }, 'Apply')
                        ),
                        React.createElement('div', { className: 'overflow-x-auto' },
                            React.createElement('table', { className: 'min-w-full text-sm' },
                                React.createElement('thead', null,
                                    React.createElement('tr', { className: 'text-left text-slate-600' },
                                        ['Date', 'Transaction ID', 'Amount', 'Status', 'Invoice'].map(h => React.createElement('th', { key: h, className: 'py-2 px-3 border-b' }, h))
                                    )
                                ),
                                React.createElement('tbody', null,
                                    billingHistory.length === 0 ? React.createElement('tr', null, React.createElement('td', { colSpan: 5, className: 'py-4 px-3 text-center text-slate-500' }, 'No transactions found')) :
                                        billingHistory.map(tx => (
                                            React.createElement('tr', { key: tx.id, className: 'hover:bg-slate-50' },
                                                React.createElement('td', { className: 'py-2 px-3 border-b' }, tx.created_at || ''),
                                                React.createElement('td', { className: 'py-2 px-3 border-b' }, tx.razorpay_payment_id || ''),
                                                React.createElement('td', { className: 'py-2 px-3 border-b' }, `â‚¹${tx.amount}`),
                                                React.createElement('td', { className: 'py-2 px-3 border-b' }, tx.status),
                                                React.createElement('td', { className: 'py-2 px-3 border-b' }, tx.invoice_available ? React.createElement('button', { onClick: () => downloadInvoice(tx.id), className: 'text-indigo-600 hover:underline' }, 'Download') : 'â€”')
                                            )
                                        ))
                                )
                            )
                        ),
                        // Pagination controls
                        React.createElement('div', { className: 'flex items-center justify-between mt-3' },
                            React.createElement('button', { disabled: !(pagination.page > 1), onClick: () => fetchBillingHistory(pagination.page - 1), className: 'px-3 py-1 rounded bg-slate-100 disabled:opacity-50' }, 'Previous'),
                            React.createElement('div', { className: 'text-sm text-slate-600' }, `Page ${pagination.page || 1} of ${pagination.total_pages || 1}`),
                            React.createElement('button', { disabled: !(pagination.page < (pagination.total_pages || 1)), onClick: () => fetchBillingHistory(pagination.page + 1), className: 'px-3 py-1 rounded bg-slate-100 disabled:opacity-50' }, 'Next')
                        )
                    ),
                    activeTab === 'upgrade' && (function () {
                        // New pricing structure: Base plans with included users
                        const planBasePrices = {
                            'basic': 1700,      // â‚¹1,700/month - includes up to 5 users
                            'si_plus': 2600,    // â‚¹2,600/month - includes up to 10 users
                            'pro': 4300         // â‚¹4,300/month - includes up to 100 users
                        };
                        const planIncludedUsers = {
                            'basic': 5,
                            'si_plus': 10,
                            'pro': 100
                        };
                        const extraUserPrice = 500; // â‚¹500/month per extra user

                        const amountPreview = (plan, users, cycle) => {
                            const basePrice = planBasePrices[plan] || 0;
                            const includedUsers = planIncludedUsers[plan] || 0;
                            const userCount = Math.max(1, parseInt(users || 1, 10));
                            const extraUsers = Math.max(0, userCount - includedUsers);
                            const extraCost = extraUsers * extraUserPrice;
                            const monthlyTotal = basePrice + extraCost;
                            const mult = cycle === 'yearly' ? 12 : 1;
                            return monthlyTotal * mult;
                        };

                        return React.createElement('div', { className: 'space-y-4' },
                            React.createElement('div', { className: 'grid grid-cols-1 sm:grid-cols-3 gap-3' },
                                ['basic', 'si_plus', 'pro'].map(p => {
                                    const basePrice = planBasePrices[p];
                                    const includedUsers = planIncludedUsers[p];
                                    const planName = p === 'si_plus' ? 'Plus Plan' : (p === 'plus' ? 'Plus Plan' : (p === 'basic' ? 'Basic Plan' : (p === 'pro' ? 'Pro Plan' : p.toUpperCase())));
                                    return React.createElement('div', { key: p, className: `p-4 rounded-lg border ${selPlan === p ? 'border-indigo-500' : 'border-slate-200'} cursor-pointer`, onClick: () => setSelPlan(p) },
                                        React.createElement('div', { className: 'text-sm text-slate-500 mb-1' }, planName),
                                        React.createElement('div', { className: 'text-xl font-semibold text-slate-800' }, `â‚¹${basePrice.toLocaleString('en-IN')}/mo`),
                                        React.createElement('div', { className: 'text-xs text-slate-600 mt-1' }, `Includes ${includedUsers} users`),
                                        React.createElement('div', { className: 'text-xs text-slate-500 mt-1' }, `â‚¹${extraUserPrice}/user extra`)
                                    );
                                })
                            ),
                            React.createElement('div', { className: 'flex flex-wrap gap-3' },
                                React.createElement('div', null,
                                    React.createElement('div', { className: 'text-xs text-slate-500 mb-1' }, 'Users'),
                                    React.createElement('input', { type: 'number', min: 1, value: selUsers, onChange: e => setSelUsers(e.target.value), className: 'p-2 border rounded w-24' })
                                ),
                                React.createElement('div', null,
                                    React.createElement('div', { className: 'text-xs text-slate-500 mb-1' }, 'Billing Cycle'),
                                    React.createElement('select', { value: selCycle, onChange: e => setSelCycle(e.target.value), className: 'p-2 border rounded' },
                                        React.createElement('option', { value: 'monthly' }, 'Monthly'),
                                        React.createElement('option', { value: 'yearly' }, 'Yearly')
                                    )
                                ),
                                React.createElement('div', { className: 'ml-auto p-2 rounded bg-slate-50 border' },
                                    React.createElement('div', { className: 'text-xs text-slate-500 mb-1' }, 'Total Amount'),
                                    React.createElement('div', { className: 'text-lg font-semibold text-slate-800' },
                                        `â‚¹${amountPreview(selPlan, selUsers, selCycle).toLocaleString('en-IN')}${selCycle === 'yearly' ? '/year' : '/month'}`
                                    )
                                )
                            ),
                            React.createElement('div', null,
                                React.createElement('button', {
                                    onClick: () => handleUpgrade(selPlan, parseInt(selUsers || 1, 10), selCycle),
                                    disabled: isUpgrading,
                                    className: 'px-4 py-2 bg-gradient-to-r from-indigo-500 to-purple-600 text-white rounded-lg disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2'
                                }, isUpgrading ? React.createElement('span', { className: 'flex items-center gap-2' },
                                    React.createElement('span', { className: 'w-4 h-4 border-2 border-white/70 border-t-transparent rounded-full animate-spin' }),
                                    'Processing...'
                                ) : 'Confirm Upgrade'
                                )
                            )
                        );
                    })()
                )
            )
        );
        return React.createElement(React.Fragment, null, closeArea, content);
    };

    const CSVImportModal = ({ onClose, onImport, selectedProject, loggedInUser }) => {
        const { useState, useRef } = React;
        const [isUploading, setIsUploading] = useState(false);
        const fileInputRef = useRef(null);

        const generateSampleCSV = () => {
            const sampleData = [
                ['WBS', 'Name', 'Duration', 'Start_Date', 'Finish_Date', 'Predecessors', 'Weightage', 'Actual_Start_Date', 'Actual_End_Date', 'Progress', 'Status', 'Is_Critical', 'Notes'],
                ['1', 'Project Root', '100', '01-01-2024', '31-12-2024', '', '100', '', '', '25', 'In Progress', 'Yes', 'Main project task'],
                ['1.1', 'Engineering Phase', '60', '01-01-2024', '28-02-2024', '', '30', '01-01-2024', '', '80', 'In Progress', 'Yes', 'Design and engineering work'],
                ['1.1.1', 'Detailed Design', '30', '01-01-2024', '31-01-2024', '', '15', '01-01-2024', '29-01-2024', '100', 'Completed', 'Yes', 'Completed ahead of schedule'],
                ['1.1.2', 'Technical Review', '15', '01-02-2024', '15-02-2024', '1.1.1', '10', '01-02-2024', '', '60', 'In Progress', 'No', 'Review in progress'],
                ['1.2', 'Procurement', '45', '15-02-2024', '31-03-2024', '1.1', '25', '', '', '0', 'Not Started', 'No', 'Awaiting engineering completion'],
                ['1.3', 'Construction', '120', '01-04-2024', '31-07-2024', '1.2', '45', '', '', '0', 'Not Started', 'Yes', 'Critical path activity']
            ];

            const csvContent = sampleData.map(row => row.map(field => `"${field}"`).join(',')).join('\n');
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', 'sample_project_template.csv');
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        };

        /**
         * Handle CSV file upload for task import
         * 
         * @param {Event} event - File input change event
         * 
         * Process:
         * 1. Extract file from input
         * 2. Create FormData with file and user email
         * 3. Upload to /api/upload?project=<encoded_project_name>
         * 4. Parse response and import tasks on success
         * 
         * Note: Project name is URL-encoded using encodeURIComponent() to handle
         *       special characters, spaces, and international characters safely.
         * 
         * API Endpoint: POST /api/upload?project=<project_name>
         * Request Body: FormData with 'file' and 'user_email' fields
         * Response: { status: 'uploaded', rows: [...] } on success
         */
        const handleFileUpload = async (event) => {
            const file = event.target.files[0];
            if (!file) return;

            setIsUploading(true);
            const formData = new FormData();
            formData.append('file', file);
            formData.append('user_email', loggedInUser?.email || 'Unknown User');

            try {
                // Upload CSV file to server
                // URL is relative and will be resolved against window.location.origin
                // Project name is URL-encoded to handle special characters
                const response = await makeAuthenticatedRequest(`/api/upload?project=${encodeURIComponent(selectedProject)}`, {
                    method: 'POST',
                    body: formData
                });
                const data = await response.json();

                if (data.status === 'uploaded') {
                    onImport(data.rows);
                    onClose();
                } else {
                    throw new Error(data.message);
                }
            } catch (error) {
                alert(`Upload failed: ${error.message}`);
            } finally {
                setIsUploading(false);
                if (fileInputRef.current) {
                    fileInputRef.current.value = '';
                }
            }
        };

        return React.createElement('div', { className: 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4' },
            React.createElement('div', { className: 'bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto' },
                React.createElement('div', { className: 'p-6 border-b border-slate-200' },
                    React.createElement('div', { className: 'flex items-center justify-between' },
                        React.createElement('h2', { className: 'text-2xl font-bold text-slate-800 flex items-center' },
                            React.createElement(UploadCloud, { size: 24, className: 'mr-3 text-blue-600' }),
                            'Import CSV File'
                        ),
                        React.createElement('button', {
                            onClick: onClose,
                            className: 'text-slate-400 hover:text-slate-600 transition-colors'
                        }, React.createElement(X, { size: 24 }))
                    )
                ),
                React.createElement('div', { className: 'p-6 space-y-6' },
                    React.createElement('div', { className: 'bg-blue-50 border border-blue-200 rounded-lg p-4' },
                        React.createElement('h3', { className: 'text-lg font-semibold text-blue-800 mb-3' }, 'CSV Format Requirements'),
                        React.createElement('div', { className: 'space-y-2 text-sm text-blue-700' },
                            React.createElement('p', null, 'â€¢ Date format must be: ', React.createElement('strong', null, 'DD-MM-YYYY'), ' (e.g., 15-03-2024)'),
                            React.createElement('p', null, 'â€¢ Required columns: WBS, Name, Duration, Start_Date, Finish_Date'),
                            React.createElement('p', null, 'â€¢ Optional columns: Predecessors, Weightage, Actual_Start_Date, Actual_End_Date, Progress, Status, Is_Critical, Notes'),
                            React.createElement('p', null, 'â€¢ WBS should follow hierarchical numbering (1, 1.1, 1.1.1, etc.)')
                        )
                    ),
                    React.createElement('div', { className: 'text-center' },
                        React.createElement('button', {
                            onClick: generateSampleCSV,
                            className: 'inline-flex items-center px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium'
                        },
                            React.createElement(DownloadCloud, { size: 18, className: 'mr-2' }),
                            'Download Sample CSV Template'
                        )
                    ),
                    React.createElement('div', { className: 'border-2 border-dashed border-slate-300 rounded-lg p-8 text-center' },
                        React.createElement('input', {
                            ref: fileInputRef,
                            type: 'file',
                            accept: '.csv',
                            onChange: handleFileUpload,
                            className: 'hidden'
                        }),
                        React.createElement('div', { className: 'space-y-4' },
                            React.createElement(UploadCloud, { size: 48, className: 'mx-auto text-slate-400' }),
                            React.createElement('div', null,
                                React.createElement('button', {
                                    onClick: () => fileInputRef.current?.click(),
                                    disabled: isUploading,
                                    className: 'inline-flex items-center px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium disabled:opacity-50 disabled:cursor-not-allowed'
                                },
                                    isUploading ? 'Uploading...' : 'Select CSV File to Import'
                                )
                            ),
                            React.createElement('p', { className: 'text-sm text-slate-500 mt-2' }, 'Choose a CSV file')
                        )
                    )
                ),
                React.createElement('div', { className: 'p-6 border-t border-slate-200 bg-slate-50 rounded-b-xl' },
                    React.createElement('div', { className: 'flex justify-end space-x-3' },
                        React.createElement('button', {
                            onClick: onClose,
                            className: 'px-4 py-2 text-slate-600 bg-slate-200 rounded-lg hover:bg-slate-300 transition-colors font-medium'
                        }, 'Cancel')
                    )
                )
            )
        );
    };

    // Trial Countdown Banner Component
    const TrialCountdownBanner = ({ trialStatus, onUpgradeClick, onDismiss, isDismissed }) => {
        // Conditional rendering checks
        if (!trialStatus || !trialStatus.is_trial) return null;
        if (isDismissed && !trialStatus.is_expired) return null;

        // Determine banner state
        const isExpired = trialStatus.is_expired;
        const isExpiringSoon = trialStatus.days_remaining <= 3 && !isExpired;
        const isActive = !isExpired && !isExpiringSoon;

        // Styling based on state
        const bgColor = isExpired ? 'bg-gradient-to-r from-red-600 to-red-700' :
            isExpiringSoon ? 'bg-gradient-to-r from-yellow-500 to-orange-500' :
                'bg-gradient-to-r from-blue-500 to-blue-600';

        const textColor = 'text-white';

        // Message text
        const message = isExpired ? 'Your trial has ended. Upgrade now to continue using PROTON.' :
            isExpiringSoon ? `Your trial expires in ${trialStatus.days_remaining} day${trialStatus.days_remaining !== 1 ? 's' : ''}! Upgrade now to continue.` :
                `Your trial expires in ${trialStatus.days_remaining} days`;

        // Render banner with React.createElement
        return React.createElement('div', {
            className: `fixed top-0 left-0 right-0 z-50 ${bgColor} ${textColor} px-6 py-3 shadow-lg trial-banner-enter`,
            role: 'alert',
            'aria-live': isExpired ? 'assertive' : 'polite'
        },
            React.createElement('div', { className: 'flex flex-col sm:flex-row items-center justify-between gap-3 max-w-7xl mx-auto' },
                // Left side: Icon and message
                React.createElement('div', { className: 'flex items-center gap-3' },
                    // Icon (conditional based on state)
                    React.createElement('span', { className: 'text-2xl' }, isExpired ? 'ðŸš«' : isExpiringSoon ? 'âš ï¸' : 'â„¹ï¸'),
                    // Message text
                    React.createElement('p', { className: 'font-semibold text-base sm:text-lg' }, message)
                ),
                // Right side: Buttons
                React.createElement('div', { className: 'flex items-center gap-3' },
                    // Upgrade button
                    React.createElement('button', {
                        onClick: onUpgradeClick,
                        className: `px-6 py-2 font-semibold rounded-lg transition-all ${isExpired || isExpiringSoon ? 'bg-white text-red-600 hover:bg-gray-100 trial-banner-pulse' : 'bg-white/20 hover:bg-white/30'}`
                    }, 'Upgrade Now'),
                    // Dismiss button (only for non-expired)
                    !isExpired && React.createElement('button', {
                        onClick: onDismiss,
                        className: 'p-1 hover:bg-white/20 rounded',
                        'aria-label': 'Dismiss banner'
                    }, React.createElement('svg', { className: 'w-5 h-5', fill: 'none', stroke: 'currentColor', viewBox: '0 0 24 24' },
                        React.createElement('path', { strokeLinecap: 'round', strokeLinejoin: 'round', strokeWidth: 2, d: 'M6 18L18 6M6 6l12 12' })
                    ))
                )
            )
        );
    };
</script>